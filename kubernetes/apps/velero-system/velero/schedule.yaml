---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: cluster-state
  namespace: velero-system
spec:
  schedule: "0 4 * * *"
  template:
    ttl: 336h
    storageLocation: b2
    snapshotVolumes: false
    defaultVolumesToFsBackup: false
    includedNamespaces:
      - "*"
    excludedNamespaces:
      - kube-system
      - kube-public
      - kube-node-lease
      - velero-system
      - longhorn-system
    includedResources:
      - namespaces
      - persistentvolumeclaims
      - persistentvolumes
      # add these ONLY if not managed by Flux:
      # - storageclasses.storage.k8s.io
      # - resourcequotas
      # - limitranges
      # - networkpolicies.networking.k8s.io
    excludedResources:
      - events
      - events.events.k8s.io
      - leases.coordination.k8s.io
      - endpoints
      - endpointslices.discovery.k8s.io
      - pods
      - replicasets
      - deployments
      - daemonsets
      - statefulsets
      - jobs
      - cronjobs
      - metrics.k8s.io
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: pinned-secrets
  namespace: velero-system
spec:
  schedule: "15 4 * * *"
  template:
    ttl: 336h
    storageLocation: b2
    snapshotVolumes: false
    defaultVolumesToFsBackup: false
    includedNamespaces: ["*"]
    includedResources: ["secrets"]
    labelSelector:
      matchLabels:
        backup.velero.io/include: "true"
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: data-critical-daily
  namespace: velero-system
spec:
  schedule: "10 4 * * *" # daily 04:10
  template:
    storageLocation: b2
    ttl: 720h # 30 days
    snapshotVolumes: true
    defaultVolumesToFsBackup: false
    includedNamespaces: ["*"]
    includedResources: ["pods", "persistentvolumeclaims", "persistentvolumes"]
    labelSelector:
      matchLabels:
        storage-tier: "critical"
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: data-high-weekly
  namespace: velero-system
spec:
  schedule: "20 4 * * 0" # Sun 04:20
  template:
    storageLocation: b2
    ttl: 2160h # 90 days
    snapshotVolumes: true
    defaultVolumesToFsBackup: false
    includedNamespaces: ["*"]
    includedResources: ["pods", "persistentvolumeclaims", "persistentvolumes"]
    labelSelector:
      matchLabels:
        storage-tier: "high"
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: data-regular-weekly
  namespace: velero-system
spec:
  schedule: "25 4 * * 3" # Wed 04:25
  template:
    storageLocation: b2
    ttl: 1080h # 45 days
    snapshotVolumes: true
    defaultVolumesToFsBackup: false
    includedNamespaces: ["*"]
    includedResources: ["pods", "persistentvolumeclaims", "persistentvolumes"]
    labelSelector:
      matchLabels:
        storage-tier: "regular"
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: data-low-weekly
  namespace: velero-system
spec:
  schedule: "30 4 * * 6" # Sat 04:30
  template:
    storageLocation: b2
    ttl: 336h # 14 days (â‰ˆ2 copies at weekly cadence)
    snapshotVolumes: true
    defaultVolumesToFsBackup: false
    includedNamespaces: ["*"]
    includedResources: ["pods", "persistentvolumeclaims", "persistentvolumes"]
    labelSelector:
      matchLabels:
        storage-tier: "low"
