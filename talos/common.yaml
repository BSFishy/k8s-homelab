# yaml-language-server: $schema=https://raw.githubusercontent.com/siderolabs/talos/refs/heads/release-1.10/website/content/v1.10/schemas/config.schema.json

machine:
  network:
    nameservers:
      - 1.1.1.1
      - 1.0.0.1
      - 2606:4700:4700::1111
      - 2606:4700:4700::1001

  kubelet:
    extraArgs:
      # increase system stability by tuning kubelet eviction profiles
      eviction-hard: "memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5%"
      eviction-soft: "memory.available<200Mi,nodefs.available<15%,nodefs.inodesFree<10%"
      eviction-soft-grace-period: "memory.available=1m,nodefs.available=1m,nodefs.inodesFree=1m"
      image-gc-high-threshold: "80"
      image-gc-low-threshold: "60"

      # increase system stability by ensuring resource space
      system-reserved: "cpu=500m,memory=512Mi,ephemeral-storage=8Gi"
      kube-reserved: "cpu=500m,memory=512Mi,ephemeral-storage=8Gi"
      serialize-image-pulls: "true"

    extraMounts:
      # create longhorn mount
      - destination: /var/lib/longhorn
        type: bind
        source: /var/lib/longhorn
        options:
          - bind
          - rshared
          - rw

  features:
    # enable dns caching
    hostDNS:
      enabled: true

    kubePrism:
      enabled: true
      port: 7445

  sysctls:
    # disable accepting ipv6 RAs
    net.ipv6.conf.all.accept_ra: "0"
    net.ipv6.conf.default.accept_ra: "0"
    net.ipv6.conf.br0.accept_ra: "0"
    net.ipv6.conf.all.autoconf: "0"
    net.ipv6.conf.default.autoconf: "0"
    net.ipv6.conf.br0.autoconf: "0"
    net.ipv6.conf.all.use_tempaddr: "0"
    net.ipv6.conf.default.use_tempaddr: "0"
    net.ipv6.conf.br0.use_tempaddr: "0"

cluster:
  network:
    podSubnets:
      - 10.244.0.0/16
      - 2001:db8:42:0::/56
    serviceSubnets:
      - 10.96.0.0/12
      - 2001:db8:42:1::/112
